import os
import pinecone
from dotenv import load_dotenv
from langchain_community.embeddings import HuggingFaceEmbeddings

load_dotenv()

pinecone.init(api_key=os.getenv("PINECONE_API_KEY"), environment=os.getenv("PINECONE_ENVIRONMENT"))

index_name = os.getenv("PINECONE_INDEX_NAME")

if index_name not in pinecone.list_indexes():
    pinecone.create_index(index_name, dimension=768)

index = pinecone.Index(index_name)
embedding_model = HuggingFaceEmbeddings(model_name="meta-llama/Meta-Llama-3.1-8B-Instruct")

def upsert_vectors(vectors):
    index.upsert(vectors)

def query_pinecone(query, top_k=5):
    query_vector = embedding_model.embed_query(query)
    results = index.query([query_vector], top_k=top_k)
    return results
